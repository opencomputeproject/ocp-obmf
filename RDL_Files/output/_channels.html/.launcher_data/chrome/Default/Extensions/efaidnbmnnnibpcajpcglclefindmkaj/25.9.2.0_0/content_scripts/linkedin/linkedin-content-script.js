/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(()=>{let t,e,n,o,i;const s="linkedin-acrobat-touch-point",c="linkedin-acrobat-touch-point-floating",r="linkedin-acrobat-touch-point-fullscreen",a="linkedin-acrobat-touch-point-accessibility",d="linkedin-acrobat-touch-point-container",l="acrobat-processed",m=async o=>{try{const i=new URL(o),s=e?.buildAcrobatPromotionSource("linkedin_chrome","post_view");i.searchParams.set("acrobatPromotionSource",s);const c=i.toString();let r=chrome.runtime.getURL("viewer.html")+"?pdfurl="+encodeURIComponent(c);const a=(()=>{const n=e?.getElementFromParent(t?.config?.selectors?.pdfAttachmentTitle,document);if(n&&n.innerText)return n.innerText.split("\n")[0];return""})();a&&(r+="&pdffilename="+encodeURIComponent(a)),window.open(r,"_blank"),e?.sendAnalytics([["DCBrowserExt:LinkedIn:TouchPoint:Clicked"]]),n?.acrobatTouchPointClicked("acrobat-linkedin-fte-state")}catch(t){e?.sendErrorLog("LinkedInTouchPoint","Failure in acrobatTouchPointEventHandler")}},u=(n,o=!1)=>{const i=document.createElement("div"),r=e?.createAcrobatIconElement("linkedin-acrobat-touch-point-icon","browser/images/acrobat_dc_appicon_128.png"),a=(()=>{const e=document.createElement("span");return e.setAttribute("class","linkedin-acrobat-touch-point-text"),e.textContent=t?.config?.touchPointString||"Open in Acrobat",e})();i.classList.add(s),o&&i.classList.add(c),i.appendChild(r),i.appendChild(a);const l=document.createElement("div");return l.classList.add(d),l.appendChild(i),l.addEventListener("click",(()=>m(n))),l},h=()=>{Array.from(document.getElementsByClassName(s)).forEach((t=>{t.remove(),o?.removeFteTooltip()}))},f=()=>{chrome.runtime.onMessage.addListener((t=>{"add-fte-for-linkedin-touch-point"===t?.type?o?.addFTE(t?.frameId):"acrobatTouchPointsDisabled"===t?.content_op&&(i?.disconnect(),h())}))},g=()=>{const n=e?.getFirstElementBasedOnSelectors(t?.config?.selectors?.pdfAttachmentWithoutAcrobatIcon,document);if(!n)return;const o=n?.getAttribute("href");if(!o)return;const i=e?.getClosestElementBySelectors(n,t?.config?.selectors?.pdfAttachmentContainer);if(!i)return;const c=e?.getElementFromParent(t?.config?.selectors?.pdfAttachmentTitle,i);if(!c)return;const l=e?.getElementFromParent([d],i);if(!l)return;const m=e?.getElementFromParent([s],l);m&&(((e,n)=>{const o=t?.config?.selectors?.pdfInFullscreen?.some((t=>e?.classList.contains(t)));o?n.classList.contains(r)||n.classList.add(r):(n.classList.contains(r)&&n.classList.remove(r),n.classList.contains(a)&&n.classList.remove(a))})(i,m),(n=>{const o=e?.getElementFromParent(t?.config?.selectors?.accessibilityButton,document);if(!o)return;const i=t?.config?.selectors?.isAccessibilityButtonPressed?.some((t=>o?.classList.contains(t)));i&&!n.classList.contains(a)?n.classList.add(a):!i&&n.classList.contains(a)&&n.classList.remove(a)})(m),((t,e)=>{e.style.display=(t?.getBoundingClientRect()?.width||0)<400?"none":""})(c,l))},p=(t=[],n=document)=>{if(!Array.isArray(t)||0===t.length)return[];const o=t.map((t=>`${t}:not([${l}="Y"])`));return e?.getElementsListBasedOnSelectors(o,n)||[]},b=()=>{f(),(()=>{if(!t?.adobeCleanFontAdded){const e=chrome.runtime.getURL("browser/css/fonts/AdobeClean-Regular.otf"),n=new FontFace("AdobeClean-Regular",`url(${e})`);n.load().then((()=>{document.fonts.add(n)})),t.adobeCleanFontAdded=!0}})(),(()=>{const n=p(t?.config?.selectors?.pdfAttachmentWithoutAcrobatIcon);n?.length&&n?.forEach((n=>{const o=n?.getAttribute("href");if("string"!=typeof(i=o)||!i.includes("document-pdf-analyzed"))return;var i;const s=u(o),c=e?.getClosestElementBySelectors(n,t?.config?.selectors?.pdfAttachmentContainer);if(!c)return;const r=e?.getElementFromParent(t?.config?.selectors?.pdfAttachmentTitle,c);if(!r)return;if((r?.getBoundingClientRect()?.width||0)<400)return;r.append(s);const a=s?.getBoundingClientRect();chrome.runtime.sendMessage({main_op:"linkedin-touch-point-added",frameId:t?.config?.frameId,position:{top:a.top,left:a.left,right:a.right,bottom:a.bottom}}),n.setAttribute(l,"Y"),e?.sendAnalytics([["DCBrowserExt:LinkedIn:TouchPoint:Shown"]])}))})(),g()},L=()=>{const n=e?.isAnalyticsSentInTheMonthOrSession("DCBrowserExt:LinkedIn:ChatPdf:Shown"),o=e?.isAnalyticsSentInTheMonthOrSession("DCBrowserExt:LinkedIn:ChatPdf:Clicked");n&&o||(()=>{const n=p(t?.config?.selectors?.linkedInChat?.chatMessageContainer);if(n?.length)for(const o of n){o.setAttribute(l,"Y");const n=e?.getFirstElementBasedOnSelectors(t?.config?.selectors?.linkedInChat?.chatMessageElement,o);if(n&&n.classList.contains(t?.config?.selectors?.linkedInChat?.chatMessageWithPdfAttachment)){e?.sendAnalyticsOncePerMonth("DCBrowserExt:LinkedIn:ChatPdf:Shown");const n=e?.getFirstElementBasedOnSelectors(t?.config?.selectors?.linkedInChat?.chatMessageDownloadButton,o);n&&n.addEventListener("click",(()=>{e?.sendAnalyticsOncePerMonth("DCBrowserExt:LinkedIn:ChatPdf:Clicked")}))}}})()},k=()=>{const n=window.location.host;"media.licdn.com"===n&&t?.config?.enableLinkedinPDFTouchPoint&&b(),"www.linkedin.com"===n&&window.top===window.self&&(t?.config?.enableLinkedinPDFTouchPoint&&e?.sendAnalyticsOncePerMonth("DCBrowserExt:LinkedIn:TouchPoint:Enabled"),t?.config?.enableLinkedinChatPDF&&L())},C=()=>{if(document?.body)try{const e={attributes:!0,attributeFilter:["class","style"],childList:!0,subtree:!0};i=new MutationObserver((function(){i.takeRecords(),chrome?.runtime?.id?k():(i?.disconnect(),h(),t?.disconnectEventListeners())})),i.observe(document.body,e)}catch(t){}else setTimeout(C,500)};chrome.runtime.sendMessage({main_op:"linkedin-init"},(async i=>{(i?.enableLinkedinPDFTouchPoint||i?.enableLinkedinChatPDF)&&(async()=>{[t,e,n,o]=await Promise.all([import(chrome.runtime.getURL("content_scripts/linkedin/state.js")).then((t=>t.default)),import(chrome.runtime.getURL("content_scripts/gsuite/util.js")),import(chrome.runtime.getURL("content_scripts/gsuite/fte-utils.js")),import(chrome.runtime.getURL("content_scripts/linkedin/linkedin-fte-service.js"))])})().then((()=>{t.config=i,C(),k()}))}))})();